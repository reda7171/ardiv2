!function(e){"use strict";var t=window.houzez||{};t.MapboxUtils=function(){let o="",a="",r="",n="",i=[],l=0,s=0,p=null,c="en";"undefined"!=typeof houzez_vars&&(a=houzez_vars.admin_url+"admin-ajax.php",r=houzez_vars.user_id,n=houzez_vars.not_found,o=houzez_vars.thousands_separator,c=houzez_vars.mapboxLocaleShort);let u=()=>!!window.matchMedia("(max-width: 991px)").matches||navigator.userAgentData?.mobile===!0||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),d=function(e){for(var t=(e+="").split("."),o=t[0],a=t.length>1?"."+t[1]:"",r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1,$2");return o+a},m=e=>{if("number"!=typeof e)return e;for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1"+o+"$2");return a+r},g=function(){return{"&amp;":"&","&quot;":'"',"&#039;":"'","&#8217;":"’","&#038;":"&","&lt;":"<","&gt;":">","&#8216;":"‘","&#8230;":"…","&#8221;":"”","&#8211;":'\xe2€"',"&#8212;":'\xe2€"'}},f=function(e){e.on("load",function(){jQuery(".houzez-map-loading").hide()})},h=function(e){e.getLayer("markers")&&e.removeLayer("markers"),e.getLayer("clusters")&&e.removeLayer("clusters"),e.getLayer("cluster-count")&&e.removeLayer("cluster-count"),e.getSource("properties")&&e.removeSource("properties");for(let o=0;o<i.length;o++)i[o]&&i[o].remove();i=[],t.MapboxUtils.clearMarkers()},b=function(e){h(e)},x=function(e){if(i.length>0){let t=new mapboxgl.LngLatBounds;i.forEach(function(e){t.extend(e.getLngLat())}),e.fitBounds(t,{padding:50})}},z=e=>{if(!i.length)return;let o=t.Mapbox.getDefaultZoom(),a=i.reduce((e,t)=>e.extend(t.getLngLat()),new mapboxgl.LngLatBounds),r=a.isEmpty(),n=!r&&(1e-6>Math.abs(a.getNorth()-a.getSouth())||1e-6>Math.abs(a.getEast()-a.getWest()));if(r||n){let l;r?l=i.length?i[0].getLngLat():e.getCenter():(l=[(a.getWest()+a.getEast())/2,(a.getNorth()+a.getSouth())/2,]).lng||(l=new mapboxgl.LngLat(l[0],l[1])),e.setCenter(l),e.setZoom(o);return}e.fitBounds(a,{padding:30,animate:!1,maxZoom:o+2});let s=e.getZoom();s>o&&e.setZoom(o)},y=function(e){i.push(e)},v=function(){i=[]},$=function(e){return!!houzezMap&&("streets"===e?houzezMap.setStyle("mapbox://styles/mapbox/streets-v12"):"satellite"===e?houzezMap.setStyle("mapbox://styles/mapbox/satellite-v9"):"hybrid"===e?houzezMap.setStyle("mapbox://styles/mapbox/satellite-streets-v12"):"terrain"===e&&houzezMap.setStyle("mapbox://styles/mapbox/outdoors-v12"),!1)},k=function(){if(p){try{p.remove()}catch(e){console.error("Error closing active popup:",e)}p=null}i.forEach(function(e){if(e&&e._popup&&e._popup.isOpen())try{e._popup.remove()}catch(t){console.error("Error closing marker popup:",t)}})},M=function(e){for(let t=0;t<i.length;t++)if(i[t].propertyId&&i[t].propertyId==e)return i[t];return null},w=function(e,t=!0){if(e){"string"==typeof e&&0===e.indexOf("hz-")&&(e=e.replace("hz-","")),k();for(let o=0;o<i.length;o++)if(i[o].propertyId==e){if(l=o+1,s=e,t&&window.houzezMap){let a=window.houzezMap.getZoom();window.houzezMap.easeTo({center:i[o].getLngLat(),zoom:a,duration:500})}i[o]._popup&&(i[o].togglePopup(),p=i[o]._popup);break}}},_=function(e,t=!0){k();let o=M(e);o&&w(e,t)},P=function(e){if(e){"string"==typeof e&&0===e.indexOf("hz-")&&(e=e.replace("hz-",""));for(let t=0;t<i.length;t++)if(i[t].propertyId==e&&i[t]._popup&&i[t]._popup.isOpen()){i[t].togglePopup(),p=null;break}}},I=function(e){window.history.pushState({houzezTheme:!0},"",e)},C=function(t){var o=t||e("form.houzez-search-filters-js").first(),a=o.attr("action");if(void 0==a)return!0;var r=o.find(":input").filter(function(t,o){if(!e(o).prop("disabled")&&""!=e(o).val()&&"search_geolocation"!=e(o).attr("name")&&"search_URI"!=e(o).attr("name")&&"search_args"!=e(o).attr("name")&&"houzez_save_search_ajax"!=e(o).attr("name"))return!0}).serialize();void 0==a?a="":(a.indexOf("?"),a=a+"?"+r),I(a)},L=function(){e("#houzez-btn-map-view").on("click",function(t){t.preventDefault(),e("#half-map-listing-area, .listing-wrap").hide(),e("#map-view-wrap").show(),e("#mobile-search-form").addClass("hz-mobile-overlay-search-js"),window.setTimeout(function(){window.dispatchEvent(new Event("resize")),window.houzezMap&&window.houzezMap.resize()},100)}),e("#houzez-btn-listing-view").on("click",function(o){o.preventDefault(),e("#map-view-wrap").hide(),e("#half-map-listing-area, .listing-wrap").show(),e("#mobile-search-form").removeClass("hz-mobile-overlay-search-js"),e(".hz-item-gallery-js").removeClass("houzez-gallery-loaded"),window.setTimeout(function(){t.Core&&"function"==typeof t.Core.reinitializeAjaxFunctions&&t.Core.reinitializeAjaxFunctions()},100)})},S=function(){e("#houzez-gmap-full, #houzez-gmap-full-osm").on("click",function(){var t=e(this);t.hasClass("active")?(t.removeClass("active"),t.parents(".map-wrap").removeClass("houzez-fullscreen-map")):(t.parents(".map-wrap").addClass("houzez-fullscreen-map"),t.addClass("active")),window.setTimeout(function(){if(window.dispatchEvent(new Event("resize")),window.houzezMap&&(window.houzezMap.resize(),window.houzezMap.getCenter))try{window.houzezMap.panTo(window.houzezMap.getCenter())}catch(e){console.error("Error re-centering map:",e)}},100)})},E=function(){if(u())return;let e=document.querySelectorAll("#half-map-listing-area .hz-map-trigger");if(!e.length){console.log("No property listings found with class .hz-map-trigger");return}console.log("Found "+e.length+" property listings with map hover trigger"),e.forEach(function(e){let t=e.getAttribute("data-hz-id");t&&(e.addEventListener("mouseenter",function(){w(t,!1)}),e.addEventListener("mouseleave",function(){P(t)}))})},T=function(){if(++l>i.length&&(l=1),i[l-1]){let e=i[l-1];e.propertyId&&w(e.propertyId,!1)}},U=function(){if(--l<1&&(l=i.length),i[l-1]){let e=i[l-1];e.propertyId&&w(e.propertyId,!1)}},j=function(){e(".houzez_ajax_pagination a").on("click",function(o){o.preventDefault();let a=e(this).data("houzepagi")||0,r=e("#desktop-search-form");e("#mobile-search-form.apply-mobile-pagination").length>0&&(r=e("#mobile-search-form")),t.Mapbox.searchOnChange(null,r,a)}),e("#ajax_sort_properties").on("change",function(){let o=e("#desktop-search-form");e(this).hasClass("mobile-sortby")&&(o=e("#mobile-search-form")),t.Mapbox.searchOnChange(null,o)}),e("select.houzez_search_ajax, input.houzez_search_ajax").on("change",function(){let o=e(this).closest("form");t.Mapbox.searchOnChange(null,o)}),e(".half-map-wrap").length>0&&e(".btn-apply, .half-map-search-js-btn, #auto_complete_ajax").on("click",function(o){o.preventDefault();let a=e(this).closest("form");t.Mapbox.searchOnChange(null,a)})},A=function(e,o=!1){g(),v();for(var a=0;a<e.length;a++)if(e[a].latitude&&e[a].longitude){let r=e[a].marker_color,n=document.createElement("div");n.className="mapbox-marker","yes"==t.Mapbox.getMarkerPricePins()?(n.className+=" map-marker-label",n.innerHTML=e[a].pricePin,r?(n.style.backgroundColor=r,n.style.borderColor=r,n.style.color="#ffffff",n.style.setProperty("--triangle-color",r)):n.style.setProperty("--triangle-color","#1DABE3")):(n.style.backgroundImage="url("+(e[a].marker||"")+")",n.style.width="44px",n.style.height="56px",n.style.backgroundSize="contain",n.style.backgroundRepeat="no-repeat");let i=document.createElement("div");i.className="property-info-window";let c="";e[a].thumbnail?c+='<div class="info-window-image">'+e[a].featured_label+'<a target="'+e[a].link_target+'" href="'+e[a].url+'"><img class="img-fluid listing-thumbnail" src="'+t.Mapbox.getInfoWindowPlac()+'" data-src="'+e[a].thumbnail+'" alt="'+e[a].title+'"/></a></div>':c+='<div class="info-window-image">'+e[a].featured_label+'<a target="'+e[a].link_target+'" href="'+e[a].url+'"><img class="img-fluid listing-thumbnail" src="'+t.Mapbox.getInfoWindowPlac()+'" alt="'+e[a].title+'"/></a></div>',c+='<div class="info-content" style="padding:10px;">',e[a].price&&(c+='<div class="info-window-price">'+e[a].price+"</div>"),c+=e[a].meta,e[a].property_type&&(c+='<div class="info-window-property-type">'+e[a].property_type+"</div>"),c+=e[a].address,c+="</div>",i.innerHTML=c;let u=e[a].property_id||"",d=new mapboxgl.Popup({offset:25,closeButton:!0,closeOnClick:!1,maxWidth:"320px"}).setDOMContent(i);d.on("open",function(){console.log("Popup opened");let e=i.getElementsByClassName("listing-thumbnail");e.length&&e[0].dataset.src&&"undefined"!==e[0].dataset.src&&(e[0].src=e[0].dataset.src),p=d}),d.on("close",function(){p===d&&(p=null)});let m=new mapboxgl.Marker({element:n,clickTolerance:10}).setLngLat([parseFloat(e[a].longitude),parseFloat(e[a].latitude),]).setPopup(d).addTo(window.houzezMap);m.propertyId=u,m.getElement().addEventListener("click",function(e){e.stopPropagation(),k(),l=a+1,s=u,w(u,!1)}),y(m)}o||z(window.houzezMap)},B=function(){};return{init:B,addCommas:d,thousandSeparator:m,processSpecialChars:g,remove_map_loader:f,reloadMarkers:h,clearClusterer:b,map_bounds:x,change_map_type:$,map_next:T,map_prev:U,openPopup:w,openPopupById:_,closePopup:P,hideInfoWindows:k,findMarkerByPropertyId:M,addMarkers:A,setPushState:I,set_url:C,initMapViewToggle:L,initializeFullScreenToggle:S,initInfoboxTrigger:E,getAjaxUrl:()=>a,getUserId:()=>r,getMapLanguage:()=>c,getNotFound:()=>n,getThousandsSeparator:()=>o,getMarkers:()=>i,getCurrentMarker:()=>l,getCurrentMarkerId:()=>s,addMarker:y,clearMarkers:v,initMapSearchHandlers:j,is_mobile:u}}(),t.Mapbox=function(){let o,a="",r=1,n=12,i="",l="",s="no",p=0,c=0,u=0,d=0,m="",g=0,f=!1,h=!1,b=!1,x=0,z=null,y=12,v=18;"undefined"!=typeof houzez_vars&&(p=parseInt(houzez_vars.is_halfmap),d=parseInt(houzez_vars.houzez_default_radius),x=parseInt(houzez_vars.auto_load_map_listings),m=houzez_vars.api_mapbox);let $=()=>t.MapboxUtils.clearClusterer(o),k=()=>t.MapboxUtils.reloadMarkers(o),M=function(e){document.getElementById("listing-mapzoomin").addEventListener("click",function(){e.zoomIn(),U()})},w=function(e){document.getElementById("listing-mapzoomout").addEventListener("click",function(){e.zoomOut(),U()})},_=function(){e(".houzezMapType").on("click",function(o){o.preventDefault();var a=e(this).data("maptype");t.MapboxUtils.change_map_type(a)}),M(window.houzezMap),w(window.houzezMap),e("#houzez-gmap-next").on("click",function(){t.MapboxUtils.map_next()}),e("#houzez-gmap-prev").on("click",function(){t.MapboxUtils.map_prev()})},P=function(t,o){if(1!==x)return;z&&(clearTimeout(z),z=null);let a=e("#houzez-map-message"),r=a.find(".map-info-message");if(t<o){let n=houzez_vars.map_show_some.replace("%s",t).replace("%s",o),i=houzez_vars.zoom_in_show_more;r.html(n+"<br>"+i),a.addClass("show")}else{let l=houzez_vars.map_show_all.replace("%s",o);r.html(l),a.addClass("show")}z=setTimeout(function(){a.removeClass("show")},3e3)},I=e=>{let t=e.getCenter(),o=e.getZoom();t&&null!=o&&b&&(e.setCenter(t),e.setZoom(o))},C=function(a,r){var n=e("#houzez_ajax_container"),i=e("#half-map-listing-area .page-title span"),l=e("#ajax_sort_properties").val(),s=e(".listing-view").data("layout"),p=e(".listing-view").data("css"),c=e(".listing-view").data("view");let u=r.serialize(),d={action:"houzez_half_map_listings",paged:a,sortby:l,item_layout:s,layout_css:p,layout_view:c};d.is_pagination_request=h;let m=u+"&"+e.param(d);return e.ajax({type:"GET",dataType:"json",url:t.MapboxUtils.getAjaxUrl(),data:m,beforeSend:function(){e(".houzez-map-loading").show(),n.empty().append('<div id="houzez-map-loading" class="houzez-map-loading"><div class="mapPlaceholder"><div class="loader-ripple spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div></div>')},success:function(a){return""!=a.query&&e('input[name="search_args"]').val(a.query),""!=a.search_uri&&e('input[name="search_URI"]').val(a.search_uri),e(".map-notfound").remove(),e(".search-no-results-found").remove(),e(".houzez-map-loading").hide(),a.total_results>0?(!0===a.getProperties&&($(),k(o),o.loaded()?(t.MapboxUtils.addMarkers(a.properties,b),I(o)):o.on("load",function(){t.MapboxUtils.addMarkers(a.properties,b),I(o)}),P(a.properties.length,a.total_results)),n.empty().html(a.propHtml),i.empty().html(a.total_results),A(),houzez_listing_lightbox(),houzez_grid_image_gallery(),houzez_grid_call_to_action(),compare_for_ajax(),t.MapboxUtils.is_mobile()||t.MapboxUtils.initInfoboxTrigger(),e('[data-bs-toggle="tooltip"]').tooltip()):($(),k(o),I(o),e("#houzez-properties-map").append('<div class="map-notfound">'+t.MapboxUtils.getNotFound()+"</div>"),n.empty().html(a.propHtml),i.empty().html(a.total_results)),!1},complete:function(){h=!1,b=!1,f=!1,e(".location-trigger").find(".icon-location-target").removeClass("icon-spin")},error:function(e,t,o){console.log(e.status),console.log(e.responseText),console.log(o)}}),!1},L=function(){if(e("#houzez-properties-map").length>0){let t=e("#radius-range-slider"),o=e("#desktop-search-form");t.on("change",t=>{e('input[name="use_radius"]').prop("checked",!0),e('input[name="ne_lat"]').val(""),e('input[name="ne_lng"]').val(""),e('input[name="sw_lat"]').val(""),e('input[name="sw_lng"]').val(""),e('input[name="zoom"]').val(""),T(null,o)})}},S=function(){if(e("#houzez-properties-map").length>0){let t=e("#fromSlider_price_range_halfmap"),o=e("#toSlider_price_range_halfmap"),a=e("#desktop-search-form");t.on("change",e=>{T(null,a)}),o.on("change",e=>{T(null,a)})}},E=function(){if(e("#houzez-properties-map").length>0){let t=e("#fromSlider_price_range_mobile"),o=e("#toSlider_price_range_mobile"),a=e("#mobile-search-form");t.on("change",e=>{T(null,a)}),o.on("change",e=>{T(null,a)})}},T=function(o=null,a=null,r=0){if(f)return;let n=a;if(!n&&o&&(n=o.parents("form")),!n||!n.length){console.warn("No valid form found for search");return}f=!0,e(".hz-halfmap-paged").val(r),t.MapboxUtils.set_url(n),C(r,n)},U=()=>{if(!x)return;b=!0;let t=e("#desktop-search-form"),a=o.getBounds();if(!a)return;let r=a.getNorthEast(),n=a.getSouthWest(),i=o.getZoom();e("#mobile-search-form.hz-mobile-overlay-search-js").length>0&&(t=e("#mobile-search-form")),e('input[name="ne_lat"]').val(r.lat),e('input[name="ne_lng"]').val(r.lng),e('input[name="sw_lat"]').val(n.lat),e('input[name="sw_lng"]').val(n.lng),e('input[name="zoom"]').val(i),e('input[name="use_radius"]').prop("checked",!1),T(null,t)},j=()=>{let e=!1,t=0;o.off("dragstart"),o.off("dragend"),o.off("zoomend"),o.on("dragstart",()=>{e=!0,console.log("drag start")}),o.on("dragend",()=>{!f&&e&&(U(),t=Date.now()),e=!1})},A=function(){return e(".houzez_ajax_pagination a").on("click",function(t){t.preventDefault(),x&&(h=!0),g=e(this).data("houzepagi");let o=e("#desktop-search-form");e("#mobile-search-form.apply-mobile-pagination").length>0&&(o=e("#mobile-search-form")),T(null,o,g)}),!1},B=function(){if(e(".hz-map-field-js").length>0){var t=houzez_vars.geo_country_limit,o=houzez_vars.geocomplete_country,a=function(e){this.$container=e};a.prototype={init:function(){this.initDomElements(),this.autocomplete()},initDomElements:function(){this.addressField=this.$container.data("address-field")},autocomplete:function(){var a=this.addressField;if(null===a)return;var r=document.getElementById(a),n=e(r).parent(),i=n.find('input[name="lat"]'),l=n.find('input[name="lng"]');let s;if(void 0!=t&&void 0!=o&&("UAE"==o&&(o="AE"),s=o.toLowerCase()),"undefined"==typeof MapboxGeocoder){console.error("MapboxGeocoder is not defined! Make sure the script is loaded correctly.");return}e(r).on("input",function(){var t=e(this).val();t.length<3||e.ajax({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+encodeURIComponent(t)+".json",data:{access_token:m,autocomplete:!0,language:houzez_vars.mapboxLocale,types:"address,poi,place",country:s},success:function(t){var o=n.find(".location-suggestions");0===o.length&&(o=e('<div class="location-suggestions" style="position:absolute;z-index:1000;background:white;width:100%;border:1px solid #ccc;max-height:200px;overflow-y:auto;display:none;"></div>'),n.css("position","relative"),n.append(o)),o.empty(),t.features&&t.features.length>0?(t.features.forEach(function(t){var a=e('<div class="suggestion-item" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;"></div>');a.text(t.place_name),a.data("coordinates",t.center),a.on("click",function(){e(r).val(t.place_name);var a=t.center;if(l.val(a[0]),i.val(a[1]),e('input[name="ne_lat"]').val(""),e('input[name="ne_lng"]').val(""),e('input[name="sw_lat"]').val(""),e('input[name="sw_lng"]').val(""),e('input[name="zoom"]').val(""),e('input[name="use_radius"]').prop("checked",!0),o.hide(),p){let n=e(this);T(n)}}),o.append(a)}),o.show()):o.hide()}})}),e(document).on("click",function(t){e(t.target).closest(".location-search").length||e(".location-suggestions").hide()}),n.find(".location-trigger").on("click",function(t){t.preventDefault();let o=e(this);o.find(".icon-location-target").addClass("icon-spin"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){e.ajax({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+t.coords.longitude+","+t.coords.latitude+".json",data:{access_token:m,types:"address",limit:1,language:houzez_vars.mapbox_language||"en"},success:function(a){a.features&&a.features.length>0?e(r).val(a.features[0].place_name):e(r).val(houzez_vars.current_location),l.val(t.coords.longitude),i.val(t.coords.latitude),p?T(o):o.find(".icon-location-target").removeClass("icon-spin")},error:function(){if(e(r).val(houzez_vars.current_location),l.val(t.coords.longitude),i.val(t.coords.latitude),p){let o=e(this);T(o)}}})})})},updateCoordinate:function(t){e('input[name="lng"]').val(t[0]),e('input[name="lat"]').val(t[1]),e('input[name="ne_lat"]').val(""),e('input[name="ne_lng"]').val(""),e('input[name="sw_lat"]').val(""),e('input[name="sw_lng"]').val(""),e('input[name="zoom"]').val(""),e('input[name="use_radius"]').prop("checked",!0)}};var r=function(){var t,o=e(this);(t=new a(o)).init()};e(".hz-map-field-js").each(r)}},N=function(){if(e("#houzez-properties-map").length>0){if(!document.getElementById("houzez-mapbox-custom-css")){let d=`
                        .mapboxgl-popup {
                            z-index: 1000;
                        }
                        .mapboxgl-popup-content {
                            background: none;
                            padding: 0px;
                            border-radius: 0px;
                            box-shadow: none;
                        }
                        .mapboxgl-popup-close-button {
                            color: #f1ecec;
                            background: #000;
                            height: 20px;
                            padding: 0px 0px 2px 0px;
                            width: 20px;
                            line-height: 1px;
                            right: -20px;
                            border-radius: 0;
                            font-size: 20px;
                        }
                        .mapboxgl-popup-close-button:hover {
                            background: rgba(0,0,0,0.5);
                            color: #fff;
                        }
                        .mapbox-marker {
                            cursor: pointer;
                        }
                    `,g=document.createElement("style");g.id="houzez-mapbox-custom-css",g.innerHTML=d,document.head.appendChild(g)}let f=e("#houzez-properties-map"),h=f.data("map"),b=f.data("options"),z,$,k=0,M=0,w="mapbox://styles/mapbox/streets-v12",I=new URLSearchParams(window.location.search),C=I.get("lat"),L=I.get("lng");if(C&&L||(C=e('input[name="lat"]').val(),L=e('input[name="lng"]').val()),!h)return;try{z="object"==typeof h?h:JSON.parse(h),"object"==typeof b?$=b:b&&($=JSON.parse(b))}catch(S){console.error("Error parsing map data:",S);return}if($&&(a=$.clusterIcon,r=$.map_cluster_enable,n=$.clusterer_zoom,i=$.closeIcon,l=$.infoWindowPlac,s=$.markerPricePins,c=parseFloat($.default_lat),u=parseFloat($.default_lng),y=parseFloat($.default_zoom),v=parseFloat($.max_zoom),w=$.mapbox_style,m=$.mapbox_access_token,k=c,M=u,C&&L&&!isNaN(parseFloat(C))&&!isNaN(parseFloat(L))&&(k=parseFloat(C),M=parseFloat(L)),$.center_lat&&$.center_lng&&(k=parseFloat($.center_lat),M=parseFloat($.center_lng),C=null,L=null)),!m){console.error("Mapbox Access Token is missing."),e(f).html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Mapbox API key is missing.</p>');return}mapboxgl.accessToken=m,o=new mapboxgl.Map({container:"houzez-properties-map",style:w,center:[M,k],zoom:y,maxZoom:v,cooperativeGestures:!0,scrollZoom:!0});let E=new MapboxLanguage({defaultLanguage:t.MapboxUtils.getMapLanguage()});o.addControl(E),o.on("error",t=>{t&&t.error&&401===t.error.status&&(console.error("Invalid Mapbox token:",t.error.message),e(f).html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Invalid Mapbox token – check your API key.</p>'))}),window.houzezMap=o,t.MapboxUtils.remove_map_loader(o),o.on("load",function(){if(z.properties&&z.properties.length>0){t.MapboxUtils.addMarkers(z.properties);let a=e("#total-results").data("total-results");a>0&&P(z.properties.length,a),C&&L||!(z.properties.length>1)||t.MapboxUtils.map_bounds(o),t.MapboxUtils.is_mobile()||t.MapboxUtils.initInfoboxTrigger()}else e("#houzez-properties-map").append('<div class="map-notfound">'+t.MapboxUtils.getNotFound()+"</div>");_(),x&&p&&j()})}},O=function(){"object"==typeof mapboxgl&&(N(),t.MapboxUtils.initMapSearchHandlers(),t.MapboxUtils.initMapViewToggle(),B()),S(),E(),L(),t.MapboxUtils.initializeFullScreenToggle()};return{init:O,halfMapAjax:C,searchOnChange:T,getDefaultZoom:()=>y,getMarkerPricePins:()=>s,getInfoWindowPlac:()=>l,triggerPriceRangeSearch:S,triggerPriceRangeSearchMobile:E,triggerDistanceRangeSearch:L}}(),t.SingleAgentMapbox=function(){let o=null,a="houzez-agent-sidebar-map",r={single_map_zoom:15,mapbox_style:"mapbox://styles/mapbox/streets-v11"},n=()=>{if(e("#"+a).length<=0)return;let n=r.single_map_zoom,i=r.mapbox_style,l=houzez_vars.api_mapbox;if("undefined"==typeof mapboxgl){console.error("Mapbox GL JS is not loaded."),e("#"+a).html('<p class="text-danger p-4">Mapbox GL JS library not loaded.</p>');return}if(!l){console.error("Mapbox Access Token is missing."),e("#"+a).html('<p class="text-danger p-4">Mapbox access token is missing.</p>');return}mapboxgl.accessToken=l;let s=e("#"+a).data("lat"),p=e("#"+a).data("lng");if(""==s||""==p||isNaN(parseFloat(s))||isNaN(parseFloat(p)))console.warn("Agent map coordinates are missing or invalid."),e("#"+a).html('<p class="text-warning p-4">Agent location not available.</p>');else{let c=[parseFloat(p),parseFloat(s),];try{o=new mapboxgl.Map({container:a,style:i,center:c,zoom:n,cooperativeGestures:!0,scrollZoom:!0});let u=new MapboxLanguage({defaultLanguage:t.MapboxUtils.getMapLanguage()});o.addControl(u),o.on("error",t=>{t&&t.error&&401===t.error.status&&(console.error("Invalid Mapbox token:",t.error.message),e("#"+a).html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Invalid Mapbox token – check your API key.</p>'))}),o.addControl(new mapboxgl.NavigationControl,"top-right"),new mapboxgl.Marker().setLngLat(c).addTo(o),t.MapUtils&&"function"==typeof t.MapUtils.remove_map_loader&&t.MapUtils.remove_map_loader(o)}catch(d){console.error("Error creating Mapbox map for agent:",d),e("#"+a).html('<p class="text-danger p-4">Error initializing map.</p>')}}};return{init:n}}(),t.SinglePropertyOverviewMapbox=function(){let o,a="houzez-overview-listing-map",r={single_map_zoom:15,map_pin_type:"marker",markerPricePins:"no"},n=function(e){e.on("load",function(){jQuery(".houzez-map-loading").hide()})},i=function(){if(!document.getElementById("houzez-mapbox-custom-css")){let e=`
                        .mapboxgl-popup {
                            z-index: 1000;
                        }
                        .mapboxgl-popup-content {
                            background: none;
                            padding: 0px;
                            border-radius: 0px;
                            box-shadow: none;
                        }
                        .mapboxgl-popup-close-button {
                            color: #f1ecec;
                            background: #000;
                            height: 20px;
                            padding: 0px 0px 2px 0px;
                            width: 20px;
                            line-height: 1px;
                            right: -20px;
                            border-radius: 0;
                            font-size: 20px;
                        }
                        .mapboxgl-popup-close-button:hover {
                            background: rgba(0,0,0,0.5);
                            color: #fff;
                        }
                        .mapbox-marker {
                            cursor: pointer;
                        }
                    `,t=document.createElement("style");t.id="houzez-mapbox-custom-css",t.innerHTML=e,document.head.appendChild(t)}},l=function(){if(e("#"+a).length<=0)return;let l=e("#"+a),s=l.data("map"),p=l.data("options");if(!s)return;let c=p.mapbox_access_token;if(!c){console.error("Mapbox API key not available"),l.html('<div class="error-wrap"><p>Mapbox API key is missing. Please add it in the theme options.</p></div>');return}try{if("object"==typeof s)var u=s;else var u=JSON.parse(s);if("object"==typeof p)var d=p;else if(p)var d=JSON.parse(p)}catch(m){console.error("Error parsing map data:",m);return}let g=d?.map_pin_type==="circle",f=d?.markerPricePins||r.markerPricePins,h=parseInt(d?.single_map_zoom)||r.single_map_zoom,b=r.mapbox_style;if(!u.latitude||!u.longitude){console.error("Property coordinates not provided"),l.html('<div class="error-wrap"><p>Property coordinates not found</p></div>');return}mapboxgl.accessToken=c,b=d.mapbox_style||b,o=new mapboxgl.Map({container:a,style:b,center:[u.longitude,u.latitude],zoom:h,cooperativeGestures:!0,scrollZoom:!0});let x=new MapboxLanguage({defaultLanguage:t.MapboxUtils.getMapLanguage()});o.addControl(x),n(o),o.on("error",e=>{e&&e.error&&401===e.error.status&&(console.error("Invalid Mapbox token:",e.error.message),l.html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Invalid Mapbox token – check your API key.</p>'))}),i(),o.on("load",function(){if(g)o.addSource("circle-source",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[u.longitude,u.latitude,]}}}),o.addLayer({id:"circle-layer",type:"circle",source:"circle-source",paint:{"circle-radius":20,"circle-color":"#4f5962","circle-opacity":.35,"circle-stroke-width":2,"circle-stroke-color":"#4f5962","circle-stroke-opacity":.8}});else{let e=document.createElement("div");if(e.className="mapbox-custom-marker","yes"===f&&u.pricePin){e.className+=" map-marker-label";let t=document.createElement("div");t.className="gm-marker-price",t.innerHTML=u.pricePin,e.appendChild(t),u.marker_color?(e.style.backgroundColor=u.marker_color,e.style.borderColor=u.marker_color,e.style.color="#ffffff",e.style.setProperty("--triangle-color",u.marker_color)):e.style.setProperty("--triangle-color","#1DABE3")}else e.style.backgroundImage="url("+u.marker+")",e.style.width="44px",e.style.height="56px",e.style.backgroundSize="contain",e.style.backgroundRepeat="no-repeat";new mapboxgl.Marker({element:e}).setLngLat([u.longitude,u.latitude,]).addTo(o)}})};return{init:l}}(),t.SinglePropertyMapbox=function(){let o,a="houzez-single-listing-map",r={},n={single_map_zoom:15,map_pin_type:"marker",markerPricePins:"no"},i="mapbox://styles/mapbox/streets-v12",l={mapContainerId:"houzez-single-listing-map",streetViewContainerId:"pills-street-view",zoomInBtnId:"listing-mapzoomin",zoomOutBtnId:"listing-mapzoomout",mapTypeSelector:".houzezMapType",mapLoaderSelector:".houzez-map-loading",streetViewTabSelector:'a[href="#pills-street-view"]'},s=function(l,s){if(!mapboxgl)return console.error("Mapbox GL JS is not loaded."),!1;if(!l||!l.latitude||!l.longitude)return console.error("Single property map data (latitude/longitude) is missing."),!1;if(i=s.mapbox_style||i,!s.mapbox_access_token){e("#"+a).html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Mapbox API key is missing.</p>');return}mapboxgl.accessToken=s.mapbox_access_token;try{o=new mapboxgl.Map({container:a,style:i,cooperativeGestures:!0,center:[parseFloat(l.longitude),parseFloat(l.latitude),],zoom:parseInt(s?.single_map_zoom)||n.single_map_zoom,scrollZoom:!0});let p=new MapboxLanguage({defaultLanguage:t.MapboxUtils.getMapLanguage()});return o.addControl(p),o.on("error",t=>{t&&t.error&&401===t.error.status&&(console.error("Invalid Mapbox token:",t.error.message),e("#"+a).html('<p class="text-danger p-4 flex-grow-1 text-center mx-4">Invalid Mapbox token – check your API key.</p>'))}),o.addControl(new mapboxgl.NavigationControl,"top-right"),r[a]=o,!0}catch(c){return console.error("Error creating Mapbox map:",c),!1}},p=function(e,t){if(!o)return;let a=t?.map_pin_type==="circle",r=t?.markerPricePins||n.markerPricePins,i=[parseFloat(e.longitude),parseFloat(e.latitude),];if(a)o.on("load",()=>{o.addSource("property-circle-source",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:i}}}),o.addLayer({id:"property-circle-layer",type:"circle",source:"property-circle-source",paint:{"circle-radius":25,"circle-color":"#4f5962","circle-opacity":.35,"circle-stroke-width":2,"circle-stroke-color":"#4f5962","circle-stroke-opacity":.8}})});else{let l=document.createElement("div");if(l.className="mapbox-marker","yes"===r&&e.pricePin){l.className+=" map-marker-label";let s=document.createElement("div");s.className="gm-marker-price",s.innerHTML=e.pricePin,l.appendChild(s),e.marker_color?(l.style.backgroundColor=e.marker_color,l.style.borderColor=e.marker_color,l.style.color="#ffffff",l.style.setProperty("--triangle-color",e.marker_color)):l.style.setProperty("--triangle-color","#1DABE3")}else l.style.backgroundImage=`url(${e.marker})`,l.style.width="44px",l.style.height="56px",l.style.backgroundSize="contain",l.style.backgroundRepeat="no-repeat";new mapboxgl.Marker({element:l}).setLngLat(i).addTo(o),e.title||e.price||e.property_type}},c=function(a){let n=r[a]||o;e(document).off("click.mapzoom-"+a).on("click.mapzoom-"+a,"#"+l.zoomInBtnId,function(){n&&n.zoomIn()}),e(document).off("click.mapzoomout-"+a).on("click.mapzoomout-"+a,"#"+l.zoomOutBtnId,function(){n&&n.zoomOut()}),e(document).off("click.maptype-"+a).on("click.maptype-"+a,l.mapTypeSelector,function(o){o.preventDefault();let a=e(this).data("maptype");Object.values(r).forEach(e=>{e&&e.setStyle&&t.MapboxUtils.change_map_type(a)})})},u=function(){e(l.streetViewTabSelector).on("shown.bs.tab",function(){let t=e("#"+l.streetViewContainerId);t.html('<p class="text-center p-5">Street View not available for Mapbox in this version.</p>')})},d=function(){e(".map-media-tab").on("shown.bs.tab",function(){let t=e(e(this).attr("href")),o=t.find('[id^="houzez-single-listing-map"]');if(o.length>0){let a=o.attr("id"),n=r[a];n&&setTimeout(()=>{n.resize()},50)}else Object.values(r).forEach(e=>{e&&setTimeout(()=>{e.resize()},50)})})},m=function(){["houzez-single-listing-map","houzez-single-listing-map-address","houzez-single-listing-map-elementor",].forEach(r=>{let n=document.getElementById(r);if(!n)return;let i=n.getAttribute("data-map"),m=n.getAttribute("data-options");if(!i||!m){console.log(`Map container ${r} found, but missing data attributes.`),e(l.mapLoaderSelector).hide();return}try{let g=JSON.parse(i),f=JSON.parse(m);if(a=r,!s(g,f)){e(l.mapLoaderSelector).hide();return}p(g,f),c(r),u(),d(),t.MapboxUtils.remove_map_loader(o)}catch(h){console.error(`Error initializing single property map (${r}):`,h),e(l.mapLoaderSelector).hide()}})};return{init:m,getMapInstances:()=>r,getMapInstance:e=>r[e],resizeAllMaps(){Object.values(r).forEach(e=>{e&&e.resize&&e.resize()})}}}(),e(document).ready(function(){t.MapboxUtils.init(),(e("#houzez-properties-map").length>0||e('input[name="search_location"]').length>0)&&t.Mapbox.init(),e("#houzez-agent-sidebar-map").length>0&&t.SingleAgentMapbox.init(),e("#houzez-overview-listing-map").length>0&&t.SinglePropertyOverviewMapbox.init(),(e("#houzez-single-listing-map").length>0||e("#houzez-single-listing-map-address").length>0||e("#houzez-single-listing-map-elementor").length>0)&&t.SinglePropertyMapbox.init()}),window.houzez=t}(jQuery);